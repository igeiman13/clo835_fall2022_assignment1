name: Docker Image CI

on:
  push:
    branches: [ "master" ]
jobs:
build:
runs on: ubuntu-latest
steps:
 - name: Configure AWS credentials
   uses: aws-actions/configure/configure-aws-credentials@v1
with:
 aws-access-key-id: ${{ secrets.aws_access_key_id }}
 aws-secret-key-access: ${{ secrets.aws_secret_access_key }}
 aws-session-token: ${{ secrets.aws_session_token }}
 aws-region: us-east-1

  
id: login-ecr
uses: aws-actions/amazon-ecr-login@v1 



env:
 	ECR_REGISTERY: ${{ steps.login-ecr.outputs.registry }}
	ECR_REPOSITORY: ${{ secrets.ECR_REPOSITORY }}
  IMAGE_TAG: ${{ github.sha }}
  
run: |
  docker build -t $ECR_REGISTRY/$ECR_REPOSITORY:$IMAGE_TAG .
  docker push $ECR_REGISTRY/$ECR_REPOSITORY:$IMAGE_TAG
